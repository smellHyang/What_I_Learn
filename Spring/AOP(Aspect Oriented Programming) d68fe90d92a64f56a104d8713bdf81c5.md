# AOP(Aspect Oriented Programming)

1. AOP??
    - 관점 지향 프로그래밍
    - 특정 관점 기준으로 모듈화 할 수 있는 프로그래밍
    
    ![Untitled](AOP(Aspect%20Oriented%20Programming)%20d68fe90d92a64f56a104d8713bdf81c5/Untitled.png)
    
    → 소스코드 상에서 메소드, 필드 등 다른부분에 계속 반복해서 쓰는 코드를 발견할 수 있는데 이를 ‘흩어진 관심사’라고 부른다. 하나의 메소드가 바뀌면 나머지 메소드도 하나씩 다 바꿔줘야한다. 이 흩어진 관심사를 Aspect를 이용해서 모듈화 하고 핵심비즈니스 로직에서 분리하여 재사용하겠다는것이 요점이다.
    
    → 이때 가로 영역의 공통된 부분을 잘랐다고 하여, AOP를 크로스 컷팅(Cross-Cutting)이라고 불린다.
    
    - 공통관심사항(Cross-Cutting concern) / 핵심 관심사항(Core concern) 분리

1. OOP의 단점 개선
    - 예시 ) 모든 메소드의 호출시간을 확인하고 싶다면?
        - 모든 메소드에 들어가서 호출 시간 메소드을 작성해야한다
        - 시간을 측정하는 기능은 핵심 기능사항이아니고 공통 관심사항이다.
        - 공통관심사항하고 비즈니스 로직이 석여 유지보수가 어렵다.
        - 공통 관심사항을 별도의 공통 로직으로 만들기 어려움
        - 시간 측정 기능 로직을 변경할때 모든 로직을 찾아가면서 변경해야한다.
    - 기존 oop에서 바로보던 관점(핵심 비즈니스 로직)을 다르게 하여 부가기능적인 측면에서 보았을떄 공통 요소를 추출한다.
    - OOP : 비지니스 로직의 모듈화
        - 모듈화의 핵심 단위는 비지니스 로직
        - 부가기능을 상속이나 위임으로 처리하여 깔끔하게 모듈화가 어려움
    - AOP : 인프라 혹은 부가기능의 모듈화
        - 대표적 예 : 로깅, 트랜잭션, 보안 등
        - 각각의 모듈들의 주 목적 외에 필요한 부가적인 기능들
        
2. AOP 동작 방식
    
    ![Untitled](AOP(Aspect%20Oriented%20Programming)%20d68fe90d92a64f56a104d8713bdf81c5/Untitled%201.png)
    
    - 컨테이너에 스프링 빈을 등록할 때 실제 객체를 참조하는 가짜객체를 호출하고 이 객체가 끝나면 그떄 진짜 객체를 호출하여 실행한다.
    - 실제 객체는 스프링 빈 객체가 되는데, 스프링은 설정정보를 이용해서 어떤 빈 객체에 공통 기능을 적용할지 여부를 지정한다. 스프링 컨테이너를 초기화 하는 과정에서 빈 객체에 대한 프록시 객체를 생성하고, 원본 빈 객체 대신에 프록시 객체를 사용하는것이다.

1. AOP용어
    - Aspect
        - 여러 객체에 공통으로 적용되는 기능
        - 트랜잭션, 보안, 로깅 등이 좋은예
    - Target
        - 각 적용이 되는 대상, 핵심 비즈니스 로직을 가진 객체
    - Advice
        - 부가기능 관점의 구현코드로 적용 될 시점
        - 언제 공통 관심 기능을 핵심 로직에 적용할지를 정의
        - e.g. ‘메소드를 호출하기 전’(언제)에 ‘트랜잭션 시작’(공통기능)을 적용할건지
        - around, before, after와 같은 선언방식 사용
    - Join Point
        - Advice가 적용 가능한 시점(e.g. 메서드호출, 예외 발생, 객체생성 등등)
        - 부가기능 관점이 적용 될 수 있는 시점
    - Weaving - Advice를 핵심로직 코드에 적용하는 것
        - 핵심 비즈니스 로직에 전혀 영향을 주지 않은 상태에서 부가기능을 추가하는 처리과정
        - 런타임, 컴파일, 클래스 로드 타임시에 위빙할 수 있다.
    
2. AOP 적용방법(weaving)
    - 컴파일 타임 - 핵심로직을 구현한 소스를 컴파일할 때 알맞은 위치에 공통코드를 삽입하면 컴파일 결과  aop가 적용된 클래스 파일이 생성된다.
    - 클래스 로드타임 - 순수 컴파일한 뒤, 클래스를 로딩하는 시점에서 클래스 정보를 변경하는 방식
    - 런타임 - 스프링 AOP가 사용하는 방법, 프록시를 이용하여 AOP를 적용한다.

1. AOP 특징
    - [프록시 패턴(Proxy Pattern)](https://www.notion.so/Proxy-Pattern-ff1ccb55992d4b28b87ea1ff3f421b65) 기반이다. 스프링 컨테이너에서 실제 객체를 참조하는 가짜객체(인터페이스)를 호출한다. 이를 사용하는 이유는 기존 코드의 변경 없이 접근 제어 및 부가기능을 추가 하기 위함이다.
    - 모든 AOP 기능을 제공하는 것이 목적이 아니라, 스프링 IoC와 연동하여 엔터프라이즈 애플리케이션에서 가장 흔한 문제(중복코드, 프록시 클래스 작성의 번거로움, 객체 간 관계 복잡도 증가 등등…)를 해결하기 위한 솔루션을 제공하는 것이 목적.
    - 메소드 호출 JoinPoint만 지원한다. 필드값 변경과 같은 JoinPoint를 사용하고 싶다면 AspectJ와 같이 다양한 JoinPoint를 지원하는 aop도구를 사용해야한다.
    
2. AOP 구현(프록시기반)
    - XML 스키마 기반의 POJO클래스를 이용한 AOP 구현
        - 스프링 aop를 사용하기 위해 의존을 추가한다.
        - 공통 기능을 제공할 클래스를 구현한다.
        - xml 설정파일에 <aop:config>를 이용해서 aspect를 설정한다. advice를 어떤 pointcut에 적용할지 지정한다.
    - @Aspect 어노테이션 기반의 AOP 구현
        - xml 스키마 기반과 비슷 → xml 대신 어노테이션 사용
    - 스프링 API를 이용한 AOP 구현