## 1. 스트림의 특징

- 람다식으로 요소 처리 코드를 제공
- 내부 반복자를 사용하므로 병렬 처리가 쉬움
- 중간처리, 최종처리
    - 중간처리 - 매핑, 필터링, 정렬
    - 최종처리 - 반복, 카운팅, 평균, 총합 등 집계처리

<aside>
💡 외부 반복자? 개발자가 코드로 직적 컬렉션 요소를 반복해서 가져오는 패턴(for, while - iterator)

💡 내부 반복자? 컬렉션 내부에서 요소를 반복시키고, 개발자는 처리 코드만 제공

</aside>

## 2. 병렬처리

- 멀티코어 CPU환경에서 하나의 작업을 분할해서 각 코어가 병렬적으로 처리
- ForkJoinPool 프레임워크 사용
- 작업 처리시간을 줄이기 위해

## 3. 병렬성 구분

- 데이터 병렬성
    - 전체 데이터를 쪼개서 서브데이터로 만들고 이를 병렬처리해 작업을 마침
    - 병렬스트림 구현 방식
    - e.g. 쿼드코어 CPU경우 4개의 서브 요소로 나누고, 4새의 쓰레드가 각 서브 요소들을 병렬처리한다.
- 작업 병렬성
    - 서로 다른 작업을 병렬처리
    - 웹서버에서 사용(개별 스레드에서 병렬로 처리)
    

## 4. 포크조인(ForkJoin) 프레임워크

- 런타임 시 병렬스트림 이용할때 동작
- 포크 단계 : 전체 데이터를 서브데이터로 분리한 후 이를 멀티코어에서 병렬로 처리
- 조인 단계 : 서브 결과를 결합하여 최종 결과

![image](https://user-images.githubusercontent.com/73684562/167119782-09dfe68e-eb55-4a6e-a56a-03b020baf94a.png)

- 스레드 풀로 ForkJoinPool을 제공
    - 각 코어에서 서브 요소를 처리하는 것은 개별스레드가 해야하므로 스레드 관리 필요
    - 포크조인 프레임워크는 ExecutorService의 구현 객체인 ForkJoinPool을 사용해서 작업 스레드를 관리
    

## 5. 병렬스트림 시 주의 사항

- 확신이 없으면 직접 측정
    - 병렬스트림이 순차스트림보다 항상 빠른건 ㄴㄴ
    - 공유된 가변상태가 있을경우 올바르게 동작 안할수도있다.
- 박싱 주의
    - 자동박싱과 언박싱은 성능 저하
    - 기본형 특화스트림 사용(IntStream, LongStream...)
- 순차스트림보다 성능이 떨어질수도
    - limit, findFirst처럼 요소 순서에 의존하는 연산 수행할때 비용이 증가
    - 스트림에 요소의 순서가 상관없으면 효율적이다.
- 전체 파이프라인 연산 비교
- 데이터 수가 작으면 성능 별로..
- 스트림을 구성하는 자료구조의 적절성(ArrayList/ LinkedList)
- 중간연산이 스트림의 특성에따라 분해과정 성능이 달라질수도
    - sized스트림은 병렬처리에 효과적
    - filter는 스트림 길이를 예측할수 없어서 병렬처리 효과 별로..
- 최종 연산의 병합과정 비용 비교
    - 병합과정이 비싸면 서브스트림의 부분결과를 합치는 과정에서 상쇄
    

## 6. 병렬처리 성능 영향의 요인

- 요소의 수와 요소당 처리시간
    - 요소의 수 및 시간이 짧으면 순차처리가 오히려 빠를수 있다.
    - 병렬처리는 스레드풀생성, 쓰레드 생성이라는 비용이 들기 때문
- 스트림 소스의 종류
    - ArrayList, 배열은 인덱스접근이라 포크단계에서 쉽게 요소를 분리하여 병렬처리 시간이 절약된다.
    - HashSet, TreeSet, LinkedList...는 분리가 쉽지않아 병렬처리 늦다.
- 코어(Core)의 수
    - 싱글코어일 경우 순차처리가 빠르다.
    - 코어의 수가 많을수록 병렬처리 작업속도 향상

+) 동시성 vs 병렬성?

![image](https://user-images.githubusercontent.com/73684562/167119808-fd0e080e-da42-4dd4-a83b-2382dd231c69.png)

- 동시성 : 멀티 작업을 위해 `한 코어`에서 멀티쓰레드가 `번갈아가며` 실행
- 병렬성 : 멀티 작업을 위해 `멀티코어`를 이용해 `동시에` 실행
